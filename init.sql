
CREATE DATABASE IF NOT EXISTS gvb;
USE gvb;

-- 1. 图片/横幅表
CREATE TABLE IF NOT EXISTS banner_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE COMMENT '外部暴露ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    hash VARCHAR(32),
    name VARCHAR(100),
    image_type TINYINT(1) DEFAULT 1 COMMENT '1:本地 2:对象存储',
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 2. 广告表
CREATE TABLE IF NOT EXISTS advert_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    title VARCHAR(50) NOT NULL UNIQUE,
    href VARCHAR(200) ,
    images VARCHAR(200) NOT NULL,
    is_show TINYINT(1) DEFAULT 1,
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 3. 用户表
CREATE TABLE IF NOT EXISTS user_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    username VARCHAR(36) NOT NULL UNIQUE,
    password VARCHAR(72) NOT NULL,
    avatar VARCHAR(256),
    email VARCHAR(128),
    phone VARCHAR(18), 
    addr VARCHAR(64),
    token VARCHAR(64),
    ip VARCHAR(20) DEFAULT '127.0.0.1',
    role SMALLINT(1) DEFAULT 2 COMMENT '1:管理员 2:普通用户',
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 4. 文章表
CREATE TABLE IF NOT EXISTS article_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    title VARCHAR(255) NOT NULL UNIQUE,
    abstract TEXT NOT NULL,
    content TEXT NOT NULL,
    look_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    digg_count INT DEFAULT 0,
    collects_count INT DEFAULT 0,
    tags TEXT NOT NULL,
    banner_sn BIGINT NOT NULL COMMENT '对应banner_models的sn',
    banner_url VARCHAR(255),
    user_sn BIGINT NOT NULL COMMENT '对应user_models的sn',
    username VARCHAR(255),
    user_avatar VARCHAR(255),
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 5. 评论表
CREATE TABLE IF NOT EXISTS comment_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    content VARCHAR(256) NOT NULL,
    digg_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    parent_comment_sn BIGINT COMMENT '对应自身的sn',
    article_sn BIGINT NOT NULL COMMENT '对应article_models的sn',
    user_sn BIGINT NOT NULL COMMENT '对应user_models的sn',
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 6. 消息表
CREATE TABLE IF NOT EXISTS message_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    send_user_sn BIGINT NOT NULL,
    send_username VARCHAR(100),
    send_user_avatar VARCHAR(255),
    rev_user_sn BIGINT NOT NULL,
    rev_username VARCHAR(100),
    rev_user_avatar VARCHAR(255),
    is_read BOOLEAN DEFAULT FALSE,
    content TEXT,
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;

-- 7. 标签表
CREATE TABLE IF NOT EXISTS tag_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    title VARCHAR(100) NOT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `idx_sn` (`sn`),
    INDEX idx_title (title)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;

-- 8. 文章-标签关联表
CREATE TABLE IF NOT EXISTS article_tag_models (
    article_sn BIGINT NOT NULL,
    tag_title VARCHAR(100) NOT NULL,
    article_title VARCHAR(255) NOT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (article_sn, tag_title)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;

-- 9. 用户收藏表
CREATE TABLE IF NOT EXISTS user_collect_models (
    user_sn BIGINT NOT NULL,
    article_sn BIGINT NOT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_sn, article_sn)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;

-- 10. 聊天记录表
CREATE TABLE IF NOT EXISTS chat_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    nick_name VARCHAR(64) NOT NULL,
    avatar VARCHAR(256),
    content TEXT NOT NULL,
    ip VARCHAR(20),
    addr VARCHAR(64),
    user_sn BIGINT DEFAULT 0 COMMENT '对应user_models的sn',
    msg_type TINYINT NOT NULL,
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 11. 登录记录表
CREATE TABLE IF NOT EXISTS login_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sn BIGINT NOT NULL UNIQUE,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    username VARCHAR(36) NOT NULL,
    UNIQUE KEY `idx_sn` (`sn`)
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

-- 12. 文章点赞记录表
CREATE TABLE IF NOT EXISTS user_digg_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_sn BIGINT NOT NULL,
    article_sn BIGINT NOT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `idx_user_article` (user_sn, article_sn)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;

-- 13. 评论点赞记录表
CREATE TABLE IF NOT EXISTS user_comment_digg_models (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_sn BIGINT NOT NULL,
    comment_sn BIGINT NOT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `idx_user_comment` (user_sn, comment_sn)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;
